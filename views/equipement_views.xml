<!-- views/equipement_views.xml -->
<odoo>
    <!-- Vue liste des Ã©quipements -->
    <record id="view_equipement_tree" model="ir.ui.view">
        <field name="name">kes_inspections.equipement.list</field>
        <field name="model">kes_inspections.equipement</field>
        <field name="arch" type="xml">
            <list string="Ã‰quipements Ã  inspecter">
                <field name="code_equipement" string="Code"/>
                <field name="name" string="Nom"/>
                <field name="type_equipement" string="Type"/>
                <field name="localisation" string="Localisation"/>
                <field name="nombre_etiquettes" string="Ã‰tiquettes Ã  gÃ©nÃ©rer"/>
                <field name="total_etiquettes_generees" string="Ã‰tiquettes gÃ©nÃ©rÃ©es"/>
                <field name="state" string="Statut"/>
            </list>
        </field>
    </record>

    <!-- Vue formulaire des Ã©quipements -->
    <record id="view_equipement_form" model="ir.ui.view">
        <field name="name">kes_inspections.equipement.form</field>
        <field name="model">kes_inspections.equipement</field>
        <field name="arch" type="xml">
            <form string="Ã‰quipement d inspection">
                <header>
                    <field name="state" widget="statusbar" statusbar_visible="a_inspecter,en_cours,inspecte,conforme,non_conforme"/>
                    <button name="action_generer_etiquettes" type="object" string="GÃ©nÃ©rer Ã‰tiquettes" 
                            class="btn-primary"/>
                    <button name="action_voir_etiquettes" type="object" string="Voir Ã‰tiquettes" 
                            class="btn-secondary"/>
                </header>
                <sheet>
                    <group>
                        <group>
                            <field name="code_equipement" readonly="1" string="Code Ã©quipement"/>
                            <field name="affaire_id" readonly="1" string="Affaire parente"/>
                            <field name="type_equipement" required="1" string="Type d'Ã©quipement"/>
                        </group>
                        <group>
                            <field name="name" required="1" string="Nom de l'Ã©quipement"/>
                            <field name="localisation" string="Localisation prÃ©cise"/>
                            <field name="state" string="Statut"/>
                        </group>
                    </group>
                    
                    <group>
                        <field name="description" placeholder="Description dÃ©taillÃ©e de l'Ã©quipement..." nolabel="1"/>
                    </group>
                    
                    <group>
                        <group>
                            <field name="nombre_etiquettes" required="1" string="Nombre d'Ã©tiquettes Ã  gÃ©nÃ©rer"/>
                            <field name="total_etiquettes_generees" string="Ã‰tiquettes dÃ©jÃ  gÃ©nÃ©rÃ©es" readonly="1"/>
                            <field name="etiquettes_generes" string="Ã‰tiquettes gÃ©nÃ©rÃ©es" readonly="1"/>
                        </group>
                    </group>
                    
                    <!-- ONGLET POUR VOIR LES Ã‰TIQUETTES GÃ‰NÃ‰RÃ‰ES -->
                    <notebook>
                        <page string="Ã‰tiquettes gÃ©nÃ©rÃ©es">
                            <field name="etiquette_ids" readonly="1">
                                <list>
                                    <field name="code_etiquette" string="Code unique"/>
                                    <field name="numero_etiquette" string="NumÃ©ro"/>
                                    <field name="product_id" string="Produit"/>
                                    <field name="equipement_type" string="Type"/>
                                    <field name="date_generation" string="Date gÃ©nÃ©ration"/>
                                    
                                    <!-- ðŸ”¥ BOUTON CORRIGÃ‰ : TÃ©lÃ©charger l'Ã©tiquette PNG -->
                                    <button name="action_generate_zip_etiquettes" 
                                            type="object" 
                                            string="ðŸ“¥ TÃ©lÃ©charger" 
                                            class="btn-success"
                                            confirm="GÃ©nÃ©rer et tÃ©lÃ©charger cette Ã©tiquette en PNG ?"/>
                                </list>
                            </field>
                            
                            <!-- Bouton pour tÃ©lÃ©charger toutes les Ã©tiquettes en ZIP -->
                            <div class="oe_button_box" invisible="not etiquette_ids">
                                <button name="action_generate_zip_etiquettes" 
                                        type="object" 
                                        class="oe_stat_button" 
                                        icon="fa-download"
                                        string="TÃ©lÃ©charger toutes en ZIP">
                                    <div class="o_field_widget o_stat_info">
                                        <span class="o_stat_value">
                                            <i class="fa fa-download"/> ZIP
                                        </span>
                                        <span class="o_stat_text">Toutes les Ã©tiquettes</span>
                                    </div>
                                </button>
                            </div>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Vue liste des Ã©tiquettes - ADAPTÃ‰E -->
    <record id="view_etiquette_tree" model="ir.ui.view">
        <field name="name">kes_inspections.etiquette.list</field>
        <field name="model">kes_inspections.etiquette</field>
        <field name="arch" type="xml">
            <list string="Ã‰tiquettes gÃ©nÃ©rÃ©es">
                <field name="code_etiquette" string="Code unique"/>
                <field name="product_id" string="Produit"/>
                <field name="numero_etiquette" string="NumÃ©ro"/>
                <field name="equipement_type" string="Type"/>
                <field name="date_generation" string="Date gÃ©nÃ©ration"/>
                
                <!-- ðŸ”¥ BOUTON CORRIGÃ‰ : TÃ©lÃ©charger l'Ã©tiquette PNG -->
                <button name="action_generate_zip_etiquettes" 
                        type="object" 
                        string="ðŸ“¥ TÃ©lÃ©charger" 
                        class="btn-success"
                        confirm="GÃ©nÃ©rer et tÃ©lÃ©charger cette Ã©tiquette en PNG ?"/>
            </list>
        </field>
    </record>

    <!-- Vue formulaire des Ã©tiquettes - ADAPTÃ‰E -->
    <record id="view_etiquette_form" model="ir.ui.view">
        <field name="name">kes_inspections.etiquette.form</field>
        <field name="model">kes_inspections.etiquette</field>
        <field name="arch" type="xml">
            <form string="Ã‰tiquette unique">
                <header>
                    <!-- ðŸ”¥ NOUVEAU : Bouton pour gÃ©nÃ©rer l'Ã©tiquette -->
                    <button name="action_generate_zip_etiquettes" 
                            type="object" 
                            string="ðŸ“¥ GÃ©nÃ©rer l'Ã©tiquette PNG" 
                            class="btn-primary"
                            confirm="GÃ©nÃ©rer et tÃ©lÃ©charger cette Ã©tiquette en PNG ?"/>
                </header>
                
                <sheet>
                    <group>
                        <group>
                            <field name="code_etiquette" readonly="1" string="Code Ã©tiquette"/>
                            <field name="numero_etiquette" readonly="1" string="NumÃ©ro"/>
                            <field name="product_id" readonly="1" string="Produit"/>
                            <field name="label_template_id" readonly="1" string="ModÃ¨le d'Ã©tiquette"/>
                        </group>
                        <group>
                            <field name="sous_affaire_id" readonly="1" string="Sous-affaire"/>
                            <field name="affaire_id" readonly="1" string="Affaire"/>
                            <field name="equipement_type" readonly="1" string="Type d'Ã©quipement"/>
                            <field name="date_generation" readonly="1" string="Date gÃ©nÃ©ration"/>
                        </group>
                    </group>
                    
                    <group>
                        <field name="qr_code" string="QR Code" widget="image" options="{'preview_image': 'qr_code'}"/>
                         
                        <!-- Bouton de tÃ©lÃ©chargement du QR Code -->
                        <button name="download_qr_code" 
                            type="object" 
                            string="TÃ©lÃ©charger QR Code" 
                            class="btn-secondary"
                            invisible="not qr_code" />
                    </group>
                </sheet>

                <!-- SECTION RAPPORTS -->
                <sheet>
                    <group string="Rapports associÃ©s">
                        <field name="rapports_ids" string="Rapports" context="{'default_etiquette_id': id}" editable="bottom">
                            <list string="Liste des rapports">
                                <field name="name" string="Nom du rapport"/>
                                <field name="filename" string="Nom du fichier"/>
                                <field name="file_type" string="Type"/>
                                <field name="date_upload" string="Date d'upload"/>
                                <button name="action_download"
                                        type="object"
                                        string="TÃ©lÃ©charger"
                                        class="btn-sm"
                                        icon="fa-download"/>
                            </list>
                        </field>
                    </group>
                </sheet>

                <footer>
                    <!-- ðŸ”¥ REMPLACÃ‰ : Bouton pour tÃ©lÃ©charger l'Ã©tiquette PNG -->
                    <button name="action_generate_zip_etiquettes" 
                            type="object" 
                            string="ðŸ“¥ TÃ©lÃ©charger l'Ã©tiquette PNG" 
                            class="btn-primary"/>
                </footer>
            </form>
        </field>
    </record>

</odoo>